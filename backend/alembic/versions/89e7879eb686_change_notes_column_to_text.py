"""change notes column to Text

Revision ID: 89e7879eb686
Revises: 
Create Date: 2026-02-22 21:47:30.917871

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa


# revision identifiers, used by Alembic.
revision: str = '89e7879eb686'
down_revision: Union[str, Sequence[str], None] = None
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    """Upgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('idx_audit_action'), table_name='audit_logs')
    op.drop_index(op.f('idx_audit_created_at'), table_name='audit_logs')
    op.drop_index(op.f('idx_audit_entity'), table_name='audit_logs')
    op.drop_index(op.f('idx_audit_user_id'), table_name='audit_logs')
    op.create_index(op.f('ix_audit_logs_action_type'), 'audit_logs', ['action_type'], unique=False)
    op.create_index(op.f('ix_audit_logs_created_at'), 'audit_logs', ['created_at'], unique=False)
    op.create_index(op.f('ix_audit_logs_entity_id'), 'audit_logs', ['entity_id'], unique=False)
    op.create_index(op.f('ix_audit_logs_entity_type'), 'audit_logs', ['entity_type'], unique=False)
    op.create_index(op.f('ix_audit_logs_id'), 'audit_logs', ['id'], unique=False)
    op.create_index(op.f('ix_audit_logs_user_id'), 'audit_logs', ['user_id'], unique=False)
    op.drop_constraint(op.f('audit_logs_user_id_fkey'), 'audit_logs', type_='foreignkey')
    op.create_foreign_key(None, 'audit_logs', 'users', ['user_id'], ['id'])
    op.drop_index(op.f('idx_bulk_imports_date'), table_name='bulk_imports')
    op.drop_index(op.f('idx_bulk_imports_status'), table_name='bulk_imports')
    op.create_index(op.f('ix_bulk_imports_created_at'), 'bulk_imports', ['created_at'], unique=False)
    op.create_index(op.f('ix_bulk_imports_id'), 'bulk_imports', ['id'], unique=False)
    op.drop_constraint(op.f('bulk_imports_imported_by_fkey'), 'bulk_imports', type_='foreignkey')
    op.create_foreign_key(None, 'bulk_imports', 'users', ['imported_by'], ['id'])
    op.drop_constraint(op.f('clients_company_name_location_key'), 'clients', type_='unique')
    op.drop_index(op.f('idx_clients_active'), table_name='clients')
    op.drop_index(op.f('idx_clients_company'), table_name='clients')
    op.drop_index(op.f('idx_clients_location'), table_name='clients')
    op.create_index(op.f('ix_clients_company_name'), 'clients', ['company_name'], unique=False)
    op.create_index(op.f('ix_clients_id'), 'clients', ['id'], unique=False)
    op.create_index(op.f('ix_clients_is_active'), 'clients', ['is_active'], unique=False)
    op.create_index(op.f('ix_clients_location'), 'clients', ['location'], unique=False)
    op.create_unique_constraint('uq_client_company_location', 'clients', ['company_name', 'location'])
    op.alter_column('inventory_transactions', 'notes',
               existing_type=sa.VARCHAR(length=255),
               type_=sa.Text(),
               existing_nullable=True)
    op.drop_index(op.f('idx_transactions_client_id'), table_name='inventory_transactions')
    op.drop_index(op.f('idx_transactions_edited_at'), table_name='inventory_transactions')
    op.drop_index(op.f('idx_transactions_lifecycle'), table_name='inventory_transactions')
    op.drop_index(op.f('idx_transactions_product'), table_name='inventory_transactions')
    op.drop_index(op.f('idx_transactions_status'), table_name='inventory_transactions')
    op.drop_index(op.f('idx_transactions_type'), table_name='inventory_transactions')
    op.create_index(op.f('ix_inventory_transactions_client_id'), 'inventory_transactions', ['client_id'], unique=False)
    op.create_index(op.f('ix_inventory_transactions_created_at'), 'inventory_transactions', ['created_at'], unique=False)
    op.create_index(op.f('ix_inventory_transactions_lifecycle_status'), 'inventory_transactions', ['lifecycle_status'], unique=False)
    op.create_index(op.f('ix_inventory_transactions_product_id'), 'inventory_transactions', ['product_id'], unique=False)
    op.create_index(op.f('ix_inventory_transactions_transaction_type'), 'inventory_transactions', ['transaction_type'], unique=False)
    op.drop_constraint(op.f('inventory_transactions_client_id_fkey'), 'inventory_transactions', type_='foreignkey')
    op.drop_constraint(op.f('inventory_transactions_edited_by_fkey'), 'inventory_transactions', type_='foreignkey')
    op.create_foreign_key(None, 'inventory_transactions', 'clients', ['client_id'], ['id'])
    op.create_foreign_key(None, 'inventory_transactions', 'users', ['edited_by'], ['id'])
    op.drop_index(op.f('idx_value_history_date'), table_name='inventory_value_history')
    op.drop_constraint(op.f('inventory_value_history_history_date_key'), 'inventory_value_history', type_='unique')
    op.create_index(op.f('ix_inventory_value_history_history_date'), 'inventory_value_history', ['history_date'], unique=True)
    op.create_index(op.f('ix_inventory_value_history_id'), 'inventory_value_history', ['id'], unique=False)
    op.drop_index(op.f('idx_notifications_created_at'), table_name='notifications')
    op.drop_index(op.f('idx_notifications_is_read'), table_name='notifications')
    op.drop_index(op.f('idx_notifications_user_id'), table_name='notifications')
    op.create_index(op.f('ix_notifications_created_at'), 'notifications', ['created_at'], unique=False)
    op.create_index(op.f('ix_notifications_id'), 'notifications', ['id'], unique=False)
    op.create_index(op.f('ix_notifications_is_read'), 'notifications', ['is_read'], unique=False)
    op.create_index(op.f('ix_notifications_user_id'), 'notifications', ['user_id'], unique=False)
    op.drop_constraint(op.f('notifications_user_id_fkey'), 'notifications', type_='foreignkey')
    op.create_foreign_key(None, 'notifications', 'users', ['user_id'], ['id'])
    op.drop_index(op.f('idx_product_images_primary'), table_name='product_images')
    op.drop_index(op.f('idx_product_images_product_id'), table_name='product_images')
    op.create_index(op.f('ix_product_images_id'), 'product_images', ['id'], unique=False)
    op.create_index(op.f('ix_product_images_is_primary'), 'product_images', ['is_primary'], unique=False)
    op.create_index(op.f('ix_product_images_product_id'), 'product_images', ['product_id'], unique=False)
    op.drop_constraint(op.f('product_images_uploaded_by_fkey'), 'product_images', type_='foreignkey')
    op.drop_constraint(op.f('product_images_product_id_fkey'), 'product_images', type_='foreignkey')
    op.create_foreign_key(None, 'product_images', 'users', ['uploaded_by'], ['id'])
    op.create_foreign_key(None, 'product_images', 'products', ['product_id'], ['id'])
    op.drop_index(op.f('idx_products_active'), table_name='products')
    op.drop_index(op.f('idx_products_barcode'), table_name='products')
    op.drop_index(op.f('idx_products_deleted_at'), table_name='products')
    op.drop_index(op.f('idx_products_sku'), table_name='products')
    op.drop_constraint(op.f('products_barcode_key'), 'products', type_='unique')
    op.create_index(op.f('ix_products_barcode'), 'products', ['barcode'], unique=True)
    op.create_index(op.f('ix_products_is_active'), 'products', ['is_active'], unique=False)
    op.create_index(op.f('ix_pwa_settings_id'), 'pwa_settings', ['id'], unique=False)
    op.drop_index(op.f('idx_forecasts_date'), table_name='stock_forecasts')
    op.drop_index(op.f('idx_forecasts_product_id'), table_name='stock_forecasts')
    op.drop_constraint(op.f('stock_forecasts_product_id_forecast_date_key'), 'stock_forecasts', type_='unique')
    op.create_index(op.f('ix_stock_forecasts_id'), 'stock_forecasts', ['id'], unique=False)
    op.create_index(op.f('ix_stock_forecasts_product_id'), 'stock_forecasts', ['product_id'], unique=False)
    op.create_unique_constraint('uq_forecast_product_date', 'stock_forecasts', ['product_id', 'forecast_date'])
    op.drop_constraint(op.f('stock_forecasts_product_id_fkey'), 'stock_forecasts', type_='foreignkey')
    op.create_foreign_key(None, 'stock_forecasts', 'products', ['product_id'], ['id'])
    op.drop_index(op.f('idx_snapshots_date'), table_name='transaction_snapshots')
    op.drop_index(op.f('idx_snapshots_product_id'), table_name='transaction_snapshots')
    op.drop_constraint(op.f('transaction_snapshots_snapshot_date_product_id_key'), 'transaction_snapshots', type_='unique')
    op.create_index(op.f('ix_transaction_snapshots_id'), 'transaction_snapshots', ['id'], unique=False)
    op.create_index(op.f('ix_transaction_snapshots_product_id'), 'transaction_snapshots', ['product_id'], unique=False)
    op.create_index(op.f('ix_transaction_snapshots_snapshot_date'), 'transaction_snapshots', ['snapshot_date'], unique=False)
    op.create_unique_constraint('uq_snapshot_date_product', 'transaction_snapshots', ['snapshot_date', 'product_id'])
    op.drop_constraint(op.f('transaction_snapshots_product_id_fkey'), 'transaction_snapshots', type_='foreignkey')
    op.create_foreign_key(None, 'transaction_snapshots', 'products', ['product_id'], ['id'])
    # ### end Alembic commands ###


def downgrade() -> None:
    """Downgrade schema."""
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_constraint(None, 'transaction_snapshots', type_='foreignkey')
    op.create_foreign_key(op.f('transaction_snapshots_product_id_fkey'), 'transaction_snapshots', 'products', ['product_id'], ['id'], ondelete='CASCADE')
    op.drop_constraint('uq_snapshot_date_product', 'transaction_snapshots', type_='unique')
    op.drop_index(op.f('ix_transaction_snapshots_snapshot_date'), table_name='transaction_snapshots')
    op.drop_index(op.f('ix_transaction_snapshots_product_id'), table_name='transaction_snapshots')
    op.drop_index(op.f('ix_transaction_snapshots_id'), table_name='transaction_snapshots')
    op.create_unique_constraint(op.f('transaction_snapshots_snapshot_date_product_id_key'), 'transaction_snapshots', ['snapshot_date', 'product_id'])
    op.create_index(op.f('idx_snapshots_product_id'), 'transaction_snapshots', ['product_id'], unique=False)
    op.create_index(op.f('idx_snapshots_date'), 'transaction_snapshots', ['snapshot_date'], unique=False)
    op.drop_constraint(None, 'stock_forecasts', type_='foreignkey')
    op.create_foreign_key(op.f('stock_forecasts_product_id_fkey'), 'stock_forecasts', 'products', ['product_id'], ['id'], ondelete='CASCADE')
    op.drop_constraint('uq_forecast_product_date', 'stock_forecasts', type_='unique')
    op.drop_index(op.f('ix_stock_forecasts_product_id'), table_name='stock_forecasts')
    op.drop_index(op.f('ix_stock_forecasts_id'), table_name='stock_forecasts')
    op.create_unique_constraint(op.f('stock_forecasts_product_id_forecast_date_key'), 'stock_forecasts', ['product_id', 'forecast_date'])
    op.create_index(op.f('idx_forecasts_product_id'), 'stock_forecasts', ['product_id'], unique=False)
    op.create_index(op.f('idx_forecasts_date'), 'stock_forecasts', ['forecast_date'], unique=False)
    op.drop_index(op.f('ix_pwa_settings_id'), table_name='pwa_settings')
    op.drop_index(op.f('ix_products_is_active'), table_name='products')
    op.drop_index(op.f('ix_products_barcode'), table_name='products')
    op.create_unique_constraint(op.f('products_barcode_key'), 'products', ['barcode'])
    op.create_index(op.f('idx_products_sku'), 'products', ['sku_code'], unique=False)
    op.create_index(op.f('idx_products_deleted_at'), 'products', ['deleted_at'], unique=False)
    op.create_index(op.f('idx_products_barcode'), 'products', ['barcode'], unique=False)
    op.create_index(op.f('idx_products_active'), 'products', ['is_active'], unique=False)
    op.drop_constraint(None, 'product_images', type_='foreignkey')
    op.drop_constraint(None, 'product_images', type_='foreignkey')
    op.create_foreign_key(op.f('product_images_product_id_fkey'), 'product_images', 'products', ['product_id'], ['id'], ondelete='CASCADE')
    op.create_foreign_key(op.f('product_images_uploaded_by_fkey'), 'product_images', 'users', ['uploaded_by'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_product_images_product_id'), table_name='product_images')
    op.drop_index(op.f('ix_product_images_is_primary'), table_name='product_images')
    op.drop_index(op.f('ix_product_images_id'), table_name='product_images')
    op.create_index(op.f('idx_product_images_product_id'), 'product_images', ['product_id'], unique=False)
    op.create_index(op.f('idx_product_images_primary'), 'product_images', ['is_primary'], unique=False)
    op.drop_constraint(None, 'notifications', type_='foreignkey')
    op.create_foreign_key(op.f('notifications_user_id_fkey'), 'notifications', 'users', ['user_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_notifications_user_id'), table_name='notifications')
    op.drop_index(op.f('ix_notifications_is_read'), table_name='notifications')
    op.drop_index(op.f('ix_notifications_id'), table_name='notifications')
    op.drop_index(op.f('ix_notifications_created_at'), table_name='notifications')
    op.create_index(op.f('idx_notifications_user_id'), 'notifications', ['user_id'], unique=False)
    op.create_index(op.f('idx_notifications_is_read'), 'notifications', ['is_read'], unique=False)
    op.create_index(op.f('idx_notifications_created_at'), 'notifications', [sa.literal_column('created_at DESC')], unique=False)
    op.drop_index(op.f('ix_inventory_value_history_id'), table_name='inventory_value_history')
    op.drop_index(op.f('ix_inventory_value_history_history_date'), table_name='inventory_value_history')
    op.create_unique_constraint(op.f('inventory_value_history_history_date_key'), 'inventory_value_history', ['history_date'])
    op.create_index(op.f('idx_value_history_date'), 'inventory_value_history', ['history_date'], unique=False)
    op.drop_constraint(None, 'inventory_transactions', type_='foreignkey')
    op.drop_constraint(None, 'inventory_transactions', type_='foreignkey')
    op.create_foreign_key(op.f('inventory_transactions_edited_by_fkey'), 'inventory_transactions', 'users', ['edited_by'], ['id'], ondelete='SET NULL')
    op.create_foreign_key(op.f('inventory_transactions_client_id_fkey'), 'inventory_transactions', 'clients', ['client_id'], ['id'], ondelete='SET NULL')
    op.drop_index(op.f('ix_inventory_transactions_transaction_type'), table_name='inventory_transactions')
    op.drop_index(op.f('ix_inventory_transactions_product_id'), table_name='inventory_transactions')
    op.drop_index(op.f('ix_inventory_transactions_lifecycle_status'), table_name='inventory_transactions')
    op.drop_index(op.f('ix_inventory_transactions_created_at'), table_name='inventory_transactions')
    op.drop_index(op.f('ix_inventory_transactions_client_id'), table_name='inventory_transactions')
    op.create_index(op.f('idx_transactions_type'), 'inventory_transactions', ['transaction_type'], unique=False)
    op.create_index(op.f('idx_transactions_status'), 'inventory_transactions', ['status'], unique=False)
    op.create_index(op.f('idx_transactions_product'), 'inventory_transactions', ['product_id'], unique=False)
    op.create_index(op.f('idx_transactions_lifecycle'), 'inventory_transactions', ['lifecycle_status'], unique=False)
    op.create_index(op.f('idx_transactions_edited_at'), 'inventory_transactions', ['edited_at'], unique=False)
    op.create_index(op.f('idx_transactions_client_id'), 'inventory_transactions', ['client_id'], unique=False)
    op.alter_column('inventory_transactions', 'notes',
               existing_type=sa.Text(),
               type_=sa.VARCHAR(length=255),
               existing_nullable=True)
    op.drop_constraint('uq_client_company_location', 'clients', type_='unique')
    op.drop_index(op.f('ix_clients_location'), table_name='clients')
    op.drop_index(op.f('ix_clients_is_active'), table_name='clients')
    op.drop_index(op.f('ix_clients_id'), table_name='clients')
    op.drop_index(op.f('ix_clients_company_name'), table_name='clients')
    op.create_index(op.f('idx_clients_location'), 'clients', ['location'], unique=False)
    op.create_index(op.f('idx_clients_company'), 'clients', ['company_name'], unique=False)
    op.create_index(op.f('idx_clients_active'), 'clients', ['is_active'], unique=False)
    op.create_unique_constraint(op.f('clients_company_name_location_key'), 'clients', ['company_name', 'location'])
    op.drop_constraint(None, 'bulk_imports', type_='foreignkey')
    op.create_foreign_key(op.f('bulk_imports_imported_by_fkey'), 'bulk_imports', 'users', ['imported_by'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_bulk_imports_id'), table_name='bulk_imports')
    op.drop_index(op.f('ix_bulk_imports_created_at'), table_name='bulk_imports')
    op.create_index(op.f('idx_bulk_imports_status'), 'bulk_imports', ['status'], unique=False)
    op.create_index(op.f('idx_bulk_imports_date'), 'bulk_imports', ['created_at'], unique=False)
    op.drop_constraint(None, 'audit_logs', type_='foreignkey')
    op.create_foreign_key(op.f('audit_logs_user_id_fkey'), 'audit_logs', 'users', ['user_id'], ['id'], ondelete='CASCADE')
    op.drop_index(op.f('ix_audit_logs_user_id'), table_name='audit_logs')
    op.drop_index(op.f('ix_audit_logs_id'), table_name='audit_logs')
    op.drop_index(op.f('ix_audit_logs_entity_type'), table_name='audit_logs')
    op.drop_index(op.f('ix_audit_logs_entity_id'), table_name='audit_logs')
    op.drop_index(op.f('ix_audit_logs_created_at'), table_name='audit_logs')
    op.drop_index(op.f('ix_audit_logs_action_type'), table_name='audit_logs')
    op.create_index(op.f('idx_audit_user_id'), 'audit_logs', ['user_id'], unique=False)
    op.create_index(op.f('idx_audit_entity'), 'audit_logs', ['entity_type', 'entity_id'], unique=False)
    op.create_index(op.f('idx_audit_created_at'), 'audit_logs', [sa.literal_column('created_at DESC')], unique=False)
    op.create_index(op.f('idx_audit_action'), 'audit_logs', ['action_type'], unique=False)
    # ### end Alembic commands ###
